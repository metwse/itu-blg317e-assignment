<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Management Console</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    :root {
      --primary: #1E61FF;
      --bg1: #1a1a2e;
      --bg2: #16213e;
      --bg3: #0f3460;
      --accent: #e94560;
      --success: #00d9a5;
      --warning: #ffc107;
    }
    
    body {
      background: linear-gradient(135deg, var(--bg1) 0%, var(--bg2) 100%);
      min-height: 100vh;
      color: #f0f0f0;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }
	.text {
	  color: rgba(255,255,255,0.8) !important;
	}
	.form-check{
		color:rgba(255,255,255,0.8);
	}
    .form-label {
      color: rgba(255,255,255,0.9);
    }
    
    .navbar {
      background: rgba(15, 52, 96, 0.9) !important;
      backdrop-filter: blur(10px);
      border-bottom: 1px solid rgba(233, 69, 96, 0.3);
    }
    
    .navbar-brand {
      font-weight: 700;
      color: var(--accent) !important;
    }
    
    .card {
      background: rgba(22, 33, 62, 0.8);
      border: 1px solid rgba(233, 69, 96, 0.2);
      border-radius: 12px;
      backdrop-filter: blur(5px);
    }
    
    .card-header {
      background: rgba(15, 52, 96, 0.5);
      border-bottom: 1px solid rgba(233, 69, 96, 0.2);
      font-weight: 600;
	  color: rgba(255,255,255,0.8)
    }
    
    .nav-tabs {
      border-bottom: 2px solid var(--bg3);
    }
    
    .nav-tabs .nav-link {
      color: #a0a0a0;
      border: none;
      border-bottom: 2px solid transparent;
      margin-bottom: -2px;
      transition: all 0.3s ease;
    }
    
    .nav-tabs .nav-link:hover {
      color: #f0f0f0;
      border-color: transparent;
    }
    
    .nav-tabs .nav-link.active {
      background: transparent;
      color: var(--accent);
      border-bottom: 2px solid var(--accent);
    }
    
    .nav-pills .nav-link {
      color: #a0a0a0;
      border-radius: 8px;
      transition: all 0.3s ease;
    }
    
    .nav-pills .nav-link.active {
      background: var(--accent);
      color: white;
    }
    
    .form-control, .form-select {
      background: rgba(26, 26, 46, 0.8);
      border: 1px solid rgba(233, 69, 96, 0.3);
      color: #f0f0f0;
      border-radius: 8px;
    }
    
    .form-control:focus, .form-select:focus {
      background: rgba(26, 26, 46, 0.9);
      border-color: var(--accent);
      color: #f0f0f0;
      box-shadow: 0 0 0 0.2rem rgba(233, 69, 96, 0.25);
    }
    
    .form-control::placeholder {
      color: #6c757d;
    }
    
    .btn-primary {
      background: var(--primary);
      border: none;
      border-radius: 8px;
      transition: all 0.3s ease;
    }
    
    .btn-primary:hover {
      background: #3d7aff;
      transform: translateY(-1px);
    }
    
    .btn-success {
      background: var(--success);
      border: none;
      border-radius: 8px;
    }
    
    .btn-danger {
      background: var(--accent);
      border: none;
      border-radius: 8px;
    }
    
    .btn-warning {
      background: var(--warning);
      border: none;
      border-radius: 8px;
      color: #1a1a2e;
    }
    
    .table {
      color: #f0f0f0;
    }
    
    .table-dark {
      --bs-table-bg: rgba(22, 33, 62, 0.6);
      --bs-table-striped-bg: rgba(15, 52, 96, 0.4);
      --bs-table-hover-bg: rgba(233, 69, 96, 0.1);
      border-color: rgba(233, 69, 96, 0.2);
    }
    
    .table-dark th {
      background: rgba(15, 52, 96, 0.8);
      border-color: rgba(233, 69, 96, 0.3);
    }
    
    .table-dark td {
      border-color: rgba(233, 69, 96, 0.15);
    }
    
    .badge-scope {
      padding: 0.4em 0.8em;
      border-radius: 6px;
      font-size: 0.85em;
    }
    
    .badge-economy {
      background: var(--primary);
    }
    
    .badge-region {
      background: var(--success);
    }
    
    #output {
      min-height: 100px;
    }
    
    #output pre {
      background: rgba(15, 52, 96, 0.5);
      border: 1px solid rgba(233, 69, 96, 0.2);
      border-radius: 8px;
      padding: 1rem;
      color: #f0f0f0;
      max-height: 400px;
      overflow-y: auto;
    }
    
    .loading {
      display: inline-block;
      width: 20px;
      height: 20px;
      border: 2px solid rgba(255,255,255,0.3);
      border-radius: 50%;
      border-top-color: var(--accent);
      animation: spin 1s linear infinite;
    }
    
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    
    .action-btn {
      padding: 0.25rem 0.5rem;
      font-size: 0.875rem;
      border-radius: 6px;
      margin: 0 2px;
    }
    
    .section-title {
      color: var(--accent);
      font-size: 0.9rem;
      text-transform: uppercase;
      letter-spacing: 1px;
      margin-bottom: 1rem;
      padding-bottom: 0.5rem;
      border-bottom: 1px solid rgba(233, 69, 96, 0.3);
    }
    
    .info-box {
      background: rgba(30, 97, 255, 0.1);
      border: 1px solid rgba(30, 97, 255, 0.3);
      border-radius: 8px;
      padding: 1rem;
      margin-bottom: 1rem;
      font-size: 0.9rem;
    }
    
    .info-box code {
      background: rgba(233, 69, 96, 0.2);
      padding: 0.2em 0.4em;
      border-radius: 4px;
      color: var(--accent);
    }

    #toast {
      position: fixed;
      top: 30px;
      left: 50%;
      transform: translateX(-50%);
      padding: 20px 40px;
      font-size: 2rem;
      background: #e94560;
      color: white;
      border-radius: 10px;
      font-weight: 500;
      z-index: 9999;
      display: none;
      max-width: 600px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.3);
      cursor: pointer;
    }

    #toast.show {
      display: block;
    }
  </style>
</head>
<body>
  <div id="toast"></div>

  <nav class="navbar navbar-dark mb-4">
    <div class="container">
      <div class="d-flex align-items-center gap-3">
        <a href="index.html" class="btn btn-outline-light btn-sm">Home</a>
        <span class="navbar-brand mb-0">Management Console</span>
      </div>
      <div class="d-flex align-items-center gap-3">
        <input type="password" id="token" class="form-control form-control-sm" style="width: 250px" placeholder="Management Secret Key" autocomplete="off">
      </div>
    </div>
  </nav>

  <main class="container pb-5">
    <div class="info-box">
      <strong>Management Layer</strong> - This console handles business logic for organization management.
      Use <code>X-Management-Secret</code> header for authentication. Manages Users, Providers, and Permissions.
    </div>

    <ul class="nav nav-tabs mb-4" role="tablist">
      <li class="nav-item">
        <button class="nav-link active" data-bs-toggle="tab" data-bs-target="#users-tab" type="button">Users</button>
      </li>
      <li class="nav-item">
        <button class="nav-link" data-bs-toggle="tab" data-bs-target="#providers-tab" type="button">Providers</button>
      </li>
      <li class="nav-item">
        <button class="nav-link" data-bs-toggle="tab" data-bs-target="#permissions-tab" type="button">Permissions</button>
      </li>
    </ul>

    <div id="output" class="mb-4"></div>

    <div class="tab-content">
      <!-- Users Tab -->
      <div class="tab-pane fade show active" id="users-tab">
        <div class="row g-4">
          <div class="col-md-6">
            <div class="card">
              <div class="card-header">List Users</div>
              <div class="card-body">
                <p class="text small">Fetch all registered users in the system.</p>
                <button class="btn btn-primary" onclick="api('/users', 'GET')">Load Users</button>
              </div>
            </div>
          </div>
          
          <div class="col-md-6">
            <div class="card">
              <div class="card-header">Create User</div>
              <div class="card-body">
                <div class="mb-2">
                  <input type="text" id="user-name" class="form-control form-control-sm" placeholder="Name">
                </div>
                <div class="mb-2">
                  <input type="email" id="user-email" class="form-control form-control-sm" placeholder="Email">
                </div>
                <div class="mb-3">
                  <input type="password" id="user-password" class="form-control form-control-sm" placeholder="Password">
                </div>
                <button class="btn btn-success" onclick="createUser()">Create User</button>
              </div>
            </div>
          </div>
          
          <div class="col-md-6">
            <div class="card">
              <div class="card-header">Reset Password</div>
              <div class="card-body">
                <div class="mb-2">
                  <input type="number" id="reset-user-id" class="form-control form-control-sm" placeholder="User ID">
                </div>
                <div class="mb-3">
                  <input type="password" id="reset-password" class="form-control form-control-sm" placeholder="New Password">
                </div>
                <button class="btn btn-warning" onclick="resetPassword()">Reset Password</button>
              </div>
            </div>
          </div>
          
          <div class="col-md-6">
            <div class="card">
              <div class="card-header">Delete User</div>
              <div class="card-body">
                <div class="mb-3">
                  <input type="number" id="delete-user-id" class="form-control form-control-sm" placeholder="User ID">
                </div>
                <button class="btn btn-danger" onclick="deleteUser()">Delete User</button>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Providers Tab -->
      <div class="tab-pane fade" id="providers-tab">
        <div class="row g-4">
          <div class="col-md-6">
            <div class="card">
              <div class="card-header">List Providers</div>
              <div class="card-body">
                <p class="text small">Fetch all providers with resolved user names.</p>
                <button class="btn btn-primary" onclick="api('/providers', 'GET')">Load Providers</button>
              </div>
            </div>
          </div>
          
          <div class="col-md-6">
            <div class="card">
              <div class="card-header">Create Provider</div>
              <div class="card-body">
                <div class="mb-2">
                  <input type="text" id="provider-name" class="form-control form-control-sm" placeholder="Provider Name">
                </div>
                <div class="mb-2">
                  <input type="number" id="provider-admin-account" class="form-control form-control-sm" placeholder="Administrative Account (User ID) *">
                </div>
                <div class="mb-2">
                  <input type="number" id="provider-tech-account" class="form-control form-control-sm" placeholder="Technical Account (User ID, optional)">
                </div>
                <div class="mb-2">
                  <input type="text" id="provider-description" class="form-control form-control-sm" placeholder="Description (optional)">
                </div>
                <div class="mb-2">
                  <input type="url" id="provider-website" class="form-control form-control-sm" placeholder="Website URL (optional)">
                </div>
                <div class="mb-3 form-check">
                  <input type="checkbox" id="provider-immutable" class="form-check-input">
                  <label class="form-check-label" for="provider-immutable">Immutable (freeze provider)</label>
                </div>
                <button class="btn btn-success" onclick="createProvider()">Create Provider</button>
              </div>
            </div>
          </div>
          
          <div class="col-md-6">
            <div class="card">
              <div class="card-header">Update Provider</div>
              <div class="card-body">
                <div class="mb-2">
                  <input type="number" id="update-provider-id" class="form-control form-control-sm" placeholder="Provider ID *">
                </div>
                <div class="mb-2">
                  <input type="text" id="update-provider-name" class="form-control form-control-sm" placeholder="Name (optional)">
                </div>
                <div class="mb-2">
                  <input type="number" id="update-provider-admin" class="form-control form-control-sm" placeholder="Administrative Account (User ID)">
                </div>
                <div class="mb-2">
                  <input type="number" id="update-provider-tech" class="form-control form-control-sm" placeholder="Technical Account (User ID)">
                </div>
                <div class="mb-2">
                  <input type="text" id="update-provider-desc" class="form-control form-control-sm" placeholder="Description">
                </div>
                <div class="mb-3 form-check">
                  <input type="checkbox" id="update-provider-immutable" class="form-check-input">
                  <label class="form-check-label" for="update-provider-immutable">Immutable</label>
                </div>
                <button class="btn btn-warning" onclick="updateProvider()">Update Provider</button>
              </div>
            </div>
          </div>
          
          <div class="col-md-6">
            <div class="card">
              <div class="card-header">Delete Provider</div>
              <div class="card-body">
                <p class="text small">Warning: This will cascade delete all Permissions and Indicators.</p>
                <div class="mb-3">
                  <input type="number" id="delete-provider-id" class="form-control form-control-sm" placeholder="Provider ID">
                </div>
                <button class="btn btn-danger" onclick="deleteProvider()">Delete Provider</button>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Permissions Tab -->
      <div class="tab-pane fade" id="permissions-tab">
        <div class="row g-4">
          <div class="col-md-6">
            <div class="card">
              <div class="card-header">List Permissions</div>
              <div class="card-body">
                <p class="text small">Fetch permissions for a specific provider.</p>
                <div class="mb-3">
                  <input type="number" id="list-perm-provider" class="form-control form-control-sm" placeholder="Provider ID *">
                </div>
                <button class="btn btn-primary" onclick="listPermissions()">Load Permissions</button>
              </div>
            </div>
          </div>
          
          <div class="col-md-6">
            <div class="card">
              <div class="card-header">Grant Permission</div>
              <div class="card-body">
                <div class="mb-2">
                  <input type="number" id="grant-provider-id" class="form-control form-control-sm" placeholder="Provider ID *">
                </div>
                <div class="mb-2">
                  <input type="number" id="grant-year-start" class="form-control form-control-sm" placeholder="Year Start *">
                </div>
                <div class="mb-2">
                  <input type="number" id="grant-year-end" class="form-control form-control-sm" placeholder="Year End *">
                </div>
                <div class="mb-2">
                  <label class="text small d-block mb-1">Scope Type *</label>
                  <div class="form-check form-check-inline">
                    <input class="form-check-input" type="radio" name="scope-type" id="scope-economy" value="economy" checked onchange="toggleScopeInput()">
                    <label class="form-check-label" for="scope-economy">Economy</label>
                  </div>
                  <div class="form-check form-check-inline">
                    <input class="form-check-input" type="radio" name="scope-type" id="scope-region" value="region" onchange="toggleScopeInput()">
                    <label class="form-check-label" for="scope-region">Region</label>
                  </div>
                </div>
                <div class="mb-2" id="economy-input">
                  <input type="text" id="grant-economy-code" class="form-control form-control-sm" placeholder="Economy Code (e.g., TUR)" maxlength="3">
                </div>
                <div class="mb-2" id="region-input" style="display: none;">
                  <select id="grant-region" class="form-select form-select-sm">
                    <option value="">-- Select Region --</option>
                    <option value="EAS">East Asia & Pacific</option>
                    <option value="ECS">Europe & Central Asia</option>
                    <option value="LCN">Latin America & Caribbean</option>
                    <option value="MEA">Middle East & North Africa</option>
                    <option value="NAC">North America</option>
                    <option value="SAS">South Asia</option>
                    <option value="SSF">Sub-Saharan Africa</option>
                  </select>
                </div>
                <div class="mb-3">
                  <input type="text" id="grant-footnote" class="form-control form-control-sm" placeholder="Footnote (optional)">
                </div>
                <button class="btn btn-success" onclick="grantPermission()">Grant Permission</button>
              </div>
            </div>
          </div>
          
          <div class="col-md-6">
            <div class="card">
              <div class="card-header">Revoke Permission</div>
              <div class="card-body">
                <p class="text small">Remove a specific authorization rule by its ID.</p>
                <div class="mb-3">
                  <input type="number" id="revoke-perm-id" class="form-control form-control-sm" placeholder="Permission ID">
                </div>
                <button class="btn btn-danger" onclick="revokePermission()">Revoke Permission</button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </main>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    const $ = id => document.getElementById(id);
    const BASE_URL = '/management';

    // Load saved token
    window.addEventListener('DOMContentLoaded', () => {
      const saved = localStorage.getItem('management-token');
      if (saved) $('token').value = saved;
      $('token').addEventListener('input', () => {
        localStorage.setItem('management-token', $('token').value);
      });
    });

    function getHeaders() {
      return {
        'Content-Type': 'application/json',
        'X-Management-Secret': $('token').value
      };
    }

    function showOutput(content, isError = false) {
      if (isError) {
        const errType = typeof content === 'object' ? (content.type || content.code || 'Error') : 'Error';
        const errMsg = typeof content === 'object' ? (content.error || content.message || '') : content;
        const errDetails = typeof content === 'object' && content.details ? content.details : '';
        showToast(errType, errMsg, errDetails);
        return;
      }
      $('output').innerHTML = `<pre>${typeof content === 'string' ? content : JSON.stringify(content, null, 2)}</pre>`;
    }

    function showToast(type, msg, details = '') {
      const toast = $('toast');
      let html = `<strong>${type}:</strong> ${msg}`;
      if (details && details !== '{}') {
        html += `<br><small style="opacity:0.8;font-size:0.7em;white-space:pre-wrap;">${details}</small>`;
      }
      toast.innerHTML = html;
      toast.classList.add('show');
      setTimeout(() => toast.classList.remove('show'), 6000);
	  toast.onclick = () => toast.classList.remove('show');
    }

    function showLoading() {
      $('output').innerHTML = '<div class="d-flex align-items-center gap-2"><div class="loading"></div> Loading...</div>';
    }

    async function api(endpoint, method, body = null) {
      showLoading();
      try {
        const options = {
          method,
          headers: getHeaders()
        };
        if (body && method !== 'GET') {
          options.body = JSON.stringify(body);
        }
        const res = await fetch(BASE_URL + endpoint, options);
        const data = await res.json();
        
        if (!res.ok) {
          showOutput(data, true);
          return null;
        }
        
        if (method === 'GET' && Array.isArray(data)) {
          showTable(data, endpoint);
        } else {
          showOutput(data);
        }
        return data;
      } catch (e) {
        showOutput({ error: e.message }, true);
        return null;
      }
    }

    function showTable(data, endpoint) {
      if (!data.length) {
        showOutput('No results found.');
        return;
      }

      const keys = Object.keys(data[0]);
      let html = '<table class="table table-dark table-striped table-hover"><thead><tr>';
      keys.forEach(k => html += `<th>${formatHeader(k)}</th>`);
      html += '<th>Actions</th></tr></thead><tbody>';

      data.forEach(row => {
        html += '<tr>';
        keys.forEach(k => {
          html += `<td>${formatCell(k, row[k])}</td>`;
        });
        
        // Actions column
        const id = row.id;
        if (endpoint.includes('users')) {
          html += `<td><button class="btn btn-danger btn-sm action-btn" onclick="api('/users/${id}', 'DELETE')">üóëÔ∏è</button></td>`;
        } else if (endpoint.includes('providers')) {
          html += `<td><button class="btn btn-danger btn-sm action-btn" onclick="api('/providers/${id}', 'DELETE')">üóëÔ∏è</button></td>`;
        } else if (endpoint.includes('permissions')) {
          html += `<td><button class="btn btn-danger btn-sm action-btn" onclick="api('/permissions/${id}', 'DELETE')">üóëÔ∏è</button></td>`;
        } else {
          html += '<td></td>';
        }
        html += '</tr>';
      });

      html += '</tbody></table>';
      $('output').innerHTML = html;
    }

    function formatHeader(key) {
      return key.replace(/_/g, ' ').replace(/\b\w/g, c => c.toUpperCase());
    }

    function formatCell(key, value) {
      if (value === null || value === undefined) {
        return '<span class="text">null</span>';
      }
      if (typeof value === 'object') {
        if (value.type && value.value) {
          const badgeClass = value.type === 'economy' ? 'badge-economy' : 'badge-region';
          return `<span class="badge badge-scope ${badgeClass}">${value.type}: ${value.value}</span>`;
        }
        if (value.id !== undefined && value.name !== undefined) {
          return `<span title="ID: ${value.id}">${value.name}</span>`;
        }
        return JSON.stringify(value);
      }
      if (typeof value === 'boolean') {
        return value ? '‚úÖ' : '‚ùå';
      }
      return value;
    }

    // User functions
    function createUser() {
      const body = {
        name: $('user-name').value,
        email: $('user-email').value,
        password: $('user-password').value
      };
      if (!body.email || !body.password) {
        showOutput({ error: 'Email and password are required' }, true);
        return;
      }
      api('/users', 'POST', body);
    }

    function resetPassword() {
      const id = $('reset-user-id').value;
      const password = $('reset-password').value;
      if (!id || !password) {
        showOutput({ error: 'User ID and new password are required' }, true);
        return;
      }
      api(`/users/${id}/reset-password`, 'PATCH', { password });
    }

    function deleteUser() {
      const id = $('delete-user-id').value;
      if (!id) {
        showOutput({ error: 'User ID is required' }, true);
        return;
      }
      if (confirm('Are you sure you want to delete this user?')) {
        api(`/users/${id}`, 'DELETE');
      }
    }

    // Provider functions
    function createProvider() {
      const body = {
        name: $('provider-name').value,
        administrative_account: parseInt($('provider-admin-account').value) || null,
        technical_account: parseInt($('provider-tech-account').value) || null,
        description: $('provider-description').value || null,
        website_url: $('provider-website').value || null,
        immutable: $('provider-immutable').checked
      };
      if (!body.name || !body.administrative_account) {
        showOutput({ error: 'Provider name and administrative account are required' }, true);
        return;
      }
      api('/providers', 'POST', body);
    }

    function updateProvider() {
      const id = $('update-provider-id').value;
      if (!id) {
        showOutput({ error: 'Provider ID is required' }, true);
        return;
      }
      const body = {};
      const name = $('update-provider-name').value;
      const admin = $('update-provider-admin').value;
      const tech = $('update-provider-tech').value;
      const desc = $('update-provider-desc').value;
      const immutable = $('update-provider-immutable').checked;
      
      if (name) body.name = name;
      if (admin) body.administrative_account = parseInt(admin);
      if (tech) body.technical_account = parseInt(tech);
      if (desc) body.description = desc;
      body.immutable = immutable;
      
      api(`/providers/${id}`, 'PATCH', body);
    }

    function deleteProvider() {
      const id = $('delete-provider-id').value;
      if (!id) {
        showOutput({ error: 'Provider ID is required' }, true);
        return;
      }
      if (confirm('Are you sure? This will cascade delete all Permissions and Indicators!')) {
        api(`/providers/${id}`, 'DELETE');
      }
    }

    // Permission functions
    function listPermissions() {
      const providerIdStr = $('list-perm-provider').value.trim();
      const providerId = parseInt(providerIdStr, 10);
      if (!providerIdStr || isNaN(providerId)) {
        showOutput({ error: 'Valid Provider ID is required' }, true);
        return;
      }
      api(`/permissions?provider_id=${providerId}`, 'GET');
    }

    function grantPermission() {
      const scopeType = document.querySelector('input[name="scope-type"]:checked').value;
      const economyCode = $('grant-economy-code').value.trim().toUpperCase();
      const region = $('grant-region').value;
      
      const providerIdStr = $('grant-provider-id').value.trim();
      const yearStartStr = $('grant-year-start').value.trim();
      const yearEndStr = $('grant-year-end').value.trim();
      
      const providerId = parseInt(providerIdStr, 10);
      const yearStart = parseInt(yearStartStr, 10);
      const yearEnd = parseInt(yearEndStr, 10);
      
      if (!providerIdStr || isNaN(providerId)) {
        showOutput({ error: 'Valid Provider ID is required' }, true);
        return;
      }
      
      if (!yearStartStr || isNaN(yearStart)) {
        showOutput({ error: 'Valid Year Start is required' }, true);
        return;
      }
      
      if (!yearEndStr || isNaN(yearEnd)) {
        showOutput({ error: 'Valid Year End is required' }, true);
        return;
      }
      
      if (yearStart > yearEnd) {
        showOutput({ error: 'Year Start cannot be greater than Year End' }, true);
        return;
      }
      
      if (scopeType === 'economy' && !economyCode) {
        showOutput({ error: 'Economy Code is required' }, true);
        return;
      }
      if (scopeType === 'region' && !region) {
        showOutput({ error: 'Region is required' }, true);
        return;
      }
      
      const body = {
        provider_id: providerId,
        year_start: yearStart,
        year_end: yearEnd,
        economy_code: scopeType === 'economy' ? economyCode : null,
        region: scopeType === 'region' ? region : null,
        footnote: $('grant-footnote').value.trim() || null
      };
      
      api('/permissions', 'POST', body);
    }

    function toggleScopeInput() {
      const scopeType = document.querySelector('input[name="scope-type"]:checked').value;
      $('economy-input').style.display = scopeType === 'economy' ? 'block' : 'none';
      $('region-input').style.display = scopeType === 'region' ? 'block' : 'none';
    }

    function revokePermission() {
      const idStr = $('revoke-perm-id').value.trim();
      const id = parseInt(idStr, 10);
      if (!idStr || isNaN(id)) {
        showOutput({ error: 'Valid Permission ID is required' }, true);
        return;
      }
      if (confirm('Are you sure you want to revoke this permission?')) {
        api(`/permissions/${id}`, 'DELETE');
      }
    }
  </script>
</body>
</html>
